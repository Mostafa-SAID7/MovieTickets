@using MovieTickets.Helpers
@using Microsoft.AspNetCore.Mvc.Rendering
@model PaginatedList<MovieTickets.Models.Movie>

@{
    ViewData["Title"] = "Movies";
}

<div class="container py-4">
    <div class="row mb-3 align-items-center">
        <div class="col-md-4 mb-2">
            <input id="live-search" class="form-control" placeholder="Search movies..." value="@(ViewBag.CurrentFilter ?? "")" aria-label="Search movies" />
        </div>

        <div class="col-md-3 mb-2">
            <!-- Category select -->
            <select id="filter-category" class="form-select" aria-label="Filter by category" asp-items="ViewBag.Categories">
                <option value="">All Categories</option>
            </select>
        </div>

        <div class="col-md-3 mb-2">
            <!-- Cinema select -->
            <select id="filter-cinema" class="form-select" aria-label="Filter by cinema" asp-items="ViewBag.Cinemas">
                <option value="">All Cinemas</option>
            </select>
        </div>

        <div class="col-md-2 text-end mb-2">
            <button id="clear-filters" class="btn btn-outline-secondary btn-sm">Clear</button>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-12">
            <div id="movies-container">
                @await Html.PartialAsync("_MovieCards", Model)
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/movies.js"></script>
    <script>
        (function(){
            // initial server values for JS
            window.__MOVIES_INITIAL = {
                query: "@(ViewBag.CurrentFilter ?? "")",
                categoryId: "@(ViewBag.CurrentCategory ?? "")",
                cinemaId: "@(ViewBag.CurrentCinema ?? "")",
                pageNumber: @(Model?.PageIndex ?? 1)
            };
        })();
    </script>
}
